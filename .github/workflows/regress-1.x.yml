name: Test build and deploy process on version 1 branch

on:
  push:
    branches: [ 1.x ]
  pull_request:
    branches: [ 1.x ]

jobs:
  build-ubuntu:
    runs-on: ubuntu-20.04
    steps:
    - uses: actions/checkout@v2
    - name: autoreconf
      run: autoreconf --install
    - name: configure
      run: ./configure
    - name: make
      run: make
    - name: make check
      run: make check
    - name: make distcheck
      run: make distcheck

  build-macos:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v2
    - name: brew install
      run: brew install automake coreutils bash
    - name: autoreconf
      run: autoreconf --install
    - name: configure
      run: ./configure
    - name: make
      run: make
    - name: make check
      run: make check
    - name: make distcheck
      run: make distcheck

#  build-windows:
#    runs-on: windows-latest
#    defaults:
#      run:
#        shell: msys2 {0}
#    steps:
#    - uses: msys2/setup-msys2@v2
#      with:
#        msystem: mingw64
#        install: >-
#          autoconf
#          automake1.16
#          base-devel
#          bison
#          flex
#          mingw-w64-x86_64-toolchain
#    - uses: actions/checkout@v2
#    - name: autoreconf
#      run: autoreconf --install
#    - name: configure
#      run: ./configure
#    - name: make
#      run: make
#    - name: make check
#      run: make check
#    - name: make distcheck
#      run: make distcheck
