.\"
.\" This file is part of the Detox package.
.\"
.\" Copyright (c) Doug Harple <detox.dharple@gmail.com>
.\"
.\" For the full copyright and license information, please view the LICENSE
.\" file that was distributed with this source code.
.\"
.Dd February 15, 2021
.Dt DETOXRC 5
.Os
.Sh NAME
.Nm detoxrc
.Nd configuration file for
.Xr detox 1
.Sh OVERVIEW
.Cm detox
allows for configuration of its sequences through config files.  This document
describes how these files work.
.Sh IMPORTANT
When setting up a new set of rules, the
.Cm safe
and
.Cm wipeup
filters should always be run after a translating filter (or series thereof),
such as the
.Cm utf_8
or the
.Cm uncgi
filters.  Otherwise, the risk of introducing difficult characters into the
filename is introduced.
.Sh SYNTAX
The format of this configuration file is C-like.  It is based loosely off the
configuration files used by
.Cm named .
Each statement is semicolon terminated, and modifiers on a particular statement
are generally contained within braces.
.Bl -tag -width 0.25i
.It Cm sequence Qo Ar name Qc Bro Ar ... Brc ;
Defines a sequence of filters to run a filename through.
.Ar name
specifies how the user will refer to the particular sequence during runtime.
Quotes around the sequence name are generally optional, but should be used if
the sequence name does not start with a letter.
.Pp
There is a special sequence, named
.Ar default ,
which is the default sequence used by
.Cm detox .
This can be overridden through the command line option
.Fl s
or the environmental variable
.Ev DETOX_SEQUENCE .
.Pp
Sequence names are case sensitive and unique throughout all sequences;
that is, if a system-wide file defines
.Ar normal_seq
and a user has a sequence with the same name in their
.Pa .detoxrc ,
the users'
.Ar normal_seq
will replace the system-wide version.
.It Cm iso8859_1 ;
.It Cm iso8859_1 Bro Cm filename Qo Ar /path/to/filename Qc ; Brc ;
This transliterates
.Ar ISO 8859-1
characters between 0xA0 and 0xFF into lower
.Ar ASCII
equivalents.  The output is not necessarily safe, and should also be run
through the
.Cm safe
filter.  The default version of this filter also includes transliterations for
CP-1252 for characters between 0x80 and 0x9F.
.Pp
Under normal circumstances, the filename syntax is not needed.
.Cm detox
looks in several locations for a file called
.Pa iso8859_1.tbl ,
which is a set of rules defining how an
.Ar ISO 8859-1
character should be translated.  If
.Cm detox
can't find the translation table, it will fall back on its internal translation
table, based on the stock one.
.Pp
You can also download or create your own, and tell
.Cm detox
the location of it using the filename syntax shown above.
.Pp
You can chain together multiple
.Ar iso8859_1
filters, as long as the default value of all but the last one it empty.  This
is explained in
.Xr detox.tbl 5 .
.Pp
This filter is mutually exclusive with the
.Cm utf_8
filter.
.It Cm utf_8 ;
.It Cm utf_8 Bro Cm filename Qo Ar /path/to/filename Qc ; Brc ;
This transliterations
.Ar Unicode
characters, encoded using
.Ar UTF-8 ,
into lower ASCII equivalents.
.Pp
This operates in a manner similar to
.Cm iso8859_1 ,
except it looks for a translation table called
.Pa unicode.tbl .
.Pp
Similar to the
.Ar iso8859_1
filter, an internal table exists, based on the stock translation table.
.It Cm uncgi ;
This translates
.Ar CGI
escaped strings into their
.Ar ASCII
equivalents. The output of this is not necessarily safe, and should be run through the
.Ar safe
filter, at the least.
.It Cm safe ;
.It Cm safe Bro Cm filename Qo Ar /path/to/filename Qc ; Brc ;
This could also be called "safe for UNIX-like operating systems".  It
translates characters that are difficult to work with in UNIX environments into
characters that are not.
.Pp
Similar to the
.Ar iso8859_1
and
.Ar utf8_1
filters, this can be controlled using a translation table.  This filter also
has an internal version of the translation table based on the stock version.
.Pp
See the
.Sx SAFE
section for more details on what this filter translates by default.
.It Cm wipeup ;
.It Cm wipeup Bro Cm remove_trailing ; Brc ;
This condenses sequences of dashes and underscores into a single dash, and
removes leading dashes, underscores, and octothorpes (A.K.A. pound signs or
hash tags).
.Pp
The
.Ar remove_trailing
option removes a dash or underscore followed immediately by a period.
.Pp
See the
.Sx WIPEUP
section for more details on what this filter translates.
.It Cm max_length Bro Cm length Ar value ; Brc ;
This trims a filename down to the length specified (or less).  It is conscious
of extensions and attempts to preserve anything following the last period in a
filename.
.Pp
For instance, given a max length of 12, and a filename of
.Pa this_is_my_file.txt ,
the filter would output
.Pa this_is_.txt .
.It Cm lower ;
This translates uppercase characters into lowercase characters.  It only works
on
.Ar ASCII
characters.
.It Cm # comments
Any thing after a # on any line is ignored.
.El
.Sh EXAMPLE
.Bd -literal
sequence default {
  uncgi;
  iso8859_1 {
    filename "iso8859_1.tbl";
  };
# utf_8 {
#   filename "unicode.tbl";
# };
  safe {
    filename "safe.tbl";
  };
  wipeup {
    remove_trailing;
  };
# max_length {
#   length 128;
# };
};
.Ed
.Sh SAFE
The following characters are translated by the stock
.Cm safe
filter.  They can be tuned by updating
.Pa safe.tbl
or creating a copy of
.Pa safe.tbl
and updating your
.Ar detoxrc
file.
.Pp
.Ss Rules that apply anywhere in the filename:
.Bl -column -offset indent ".Sy Removed" ".Sy Original"
.It Sy Safe Ta Sy Original
.It _and_ Ta &
.It _ Ta \fIspace\fR ` \&! @ $ * \e | \&: \&; \&" ' < > \&? /
.It - Ta \&( \&) \&[ \&] { }
.El
.Pp
.Sh WIPEUP
The following characters are translated by the
.Cm wipeup
filter.
.Pp
.Ss Rules that apply anywhere in the filename:
.Bl -column -offset indent ".Sy Wipeup" ".Sy Original"
.It Sy Wipeup Ta Sy Original
.It - Ta -_
.It - Ta _-
.It - Ta --
.It _ Ta __
.El
.Pp
.Ss Rules that apply only at the beginning of a filename:
Any leading dashes are stripped to prevent programs from interpreting
these files as command line options.
.Bl -column -offset indent ".Sy removed" ".Sy Original"
.It Sy Wipeup Ta Sy Original
.It \fIremoved\fR Ta - _ #
.El
.Ss Rules that apply when remove trailing is enabled:
.Bl -column -offset indent ".Sy Wipeup" ".Sy Original"
.It Sy Wipeup Ta Sy Original
.It . Ta .-
.It . Ta -.
.It . Ta ._
.It . Ta _.
.El
.Pp
.Sh SEE ALSO
.Xr detox 1 ,
.Xr inline-detox 1 ,
.Xr detox.tbl 5 ,
.Xr ascii 7 ,
.Xr cp1252 7 ,
.Xr iso_8859-1 7 ,
.Xr unicode 7 ,
.Xr utf-8 7 .
.Sh AUTHORS
detox was written by
.An "Doug Harple" .
